<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Paciente - Veterinaria Alvarez</title>
    <link rel="stylesheet" href="css/estilos_comunes.css">
    <link rel="stylesheet" href="css/detalle_estilos.css">
    <script src="js/paciente_detalle.js" defer></script>
</head>
<body>

    <header>
        <div class="logo-container">
            <img src="img/logo_veterinaria.jpg" alt="Logo Veterinaria Alvarez">
            <h1>Veterinaria Alvarez - Historial Clínico</h1>
        </div>
        <div class="user-session">
            <span id="username-placeholder"></span> <button id="btn-logout" class="boton-secundario">Cerrar Sesión</button>
        </div>
    </header>

    <main>
        <div class="controles-detalle">
            <a href="index.html" class="boton-secundario">&larr; Volver a la Lista</a>
        </div>
        
        <div class="detalle-container">

            <div class="info-columna">
                <div class="info-card">
                    <h3>Datos del Paciente</h3>
                    <p><span class="info-label">Nombre:</span> <span id="detalle-nombre-paciente">Cargando...</span></p>
                    <p><span class="info-label">Especie:</span> <span id="detalle-especie">Cargando...</span></p>
                    <p><span class="info-label">Raza:</span> <span id="detalle-raza">Cargando...</span></p>
                    <p><span class="info-label">Sexo:</span> <span id="detalle-sexo">Cargando...</span></p>
                    <p><span class="info-label">Color:</span> <span id="detalle-color">Cargando...</span></p>
                    <p><span class="info-label">F. Nacimiento:</span> <span id="detalle-fecha-nacimiento">Cargando...</span></p>
                </div>
                <div class="info-card">
                    <h3>Datos del Propietario</h3>
                    <p><span class="info-label">Nombre:</span> <span id="detalle-nombre-propietario">Cargando...</span></p>
                    <p><span class="info-label">Teléfono:</span> <span id="detalle-telefono">Cargando...</span></p>
                    <p><span class="info-label">Email:</span> <span id="detalle-email">Cargando...</span></p>
                    <p><span class="info-label">Dirección:</span> <span id="detalle-direccion">Cargando...</span></p>
                </div>
                <div class="info-card">
                    <h4>Visitas Anteriores</h4>
                    <div id="historial-lista-container">
                        <p>Cargando historial...</p>
                    </div>
                </div>
            </div>

            <div class="historial-columna">
                <h3>Agregar Visita al Historial</h3>
                <div class="info-card">
                    <form id="form-nueva-visita">
                        <input type="hidden" name="id_paciente" id="id_paciente_visita"> <div class="form-group">
                            <label for="tipo-visita">Tipo de Visita:</label>
                            <select id="tipo-visita" name="tipo_visita" required>
                                <option value="Consulta General" selected>Consulta General</option>
                                <option value="Urgencia">Urgencia</option>
                                <option value="Vacunación">Vacunación</option>
                                <option value="Cirugía">Cirugía</option>
                                <option value="Control Post-Operatorio">Control Post-Operatorio</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="motivo-consulta">Motivo de la Consulta (Síntomas):</label>
                            <input type="text" id="motivo-consulta" name="motivo_consulta" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="examenes-complementarios">Exámenes Complementarios (Solicitados/Resultados):</label>
                            <textarea id="examenes-complementarios" name="examenes_complementarios" rows="3"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="diagnostico">Diagnóstico:</label>
                            <textarea id="diagnostico" name="diagnostico" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="tratamiento">Notas del Tratamiento:</label>
                            <textarea id="tratamiento" name="tratamiento" rows="2" placeholder="Notas adicionales sobre el procedimiento..."></textarea>
                        </div>
                
                        <div class="form-group" id="productos-utilizados-section">
                            <label>Productos Utilizados en la Visita:</label>
                            <div class="search-producto-wrapper">
                                <input type="text" id="search-producto-input" placeholder="Buscar producto por nombre...">
                                <div id="search-producto-results"></div>
                            </div>
                            <div id="productos-seleccionados-list">
                                </div>
                            <input type="hidden" name="productos_usados" id="productos_usados_hidden_input">
                        </div>
                        <label>Signos Vitales</label>
                        <div class="form-row">
                            <div class="form-group">
                                <input type="number" step="0.1" id="temperatura" name="temperatura" placeholder="Temp. (°C)">
                            </div>
                            <div class="form-group">
                                <input type="number" id="frecuencia-cardiaca" name="frecuencia_cardiaca" placeholder="Frec. Cardíaca">
                            </div>
                            <div class="form-group">
                                <input type="number" id="frecuencia-respiratoria" name="frecuencia_respiratoria" placeholder="Frec. Resp.">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="peso">Peso (Kg):</label>
                            <input type="number" step="0.01" id="peso" name="peso" placeholder="ej. 5.25">
                        </div>
                        <div class="form-group">
                            <label for="archivos">Archivos Adjuntos (Radiografías, Labs, etc.):</label>
                            <input type="file" id="archivos" name="archivos[]" multiple>
                        </div>
                        <div class="form-group">
                            <label for="proxima-cita">Próxima Cita:</label>
                            <input type="date" id="proxima-cita" name="proxima_cita">
                        </div>
                        
                        <div class="form-group">
                            <label for="doctor-encargado">Doctor Encargado:</label>
                            <select id="doctor-encargado" name="doctor_encargado" required>
                                <option value="" disabled selected>Seleccionar doctor...</option>
                                <option value="Dr. Willian Armando Alvarez Ramos">Dr. Willian Armando Alvarez Ramos</option>
                                <option value="Dra. Tamara Abigail Alvarez Flores">Dra. Tamara Abigail Alvarez Flores</option>
                            </select>
                        </div>

                        <button type="submit" class="boton-primario">Guardar Visita</button>
                        <div id="mensaje-visita" class="mensaje" style="display: none;"></div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <div id="modal-visita-detalle" class="modal">
        <div class="modal-contenido">
            <span class="cerrar-modal">&times;</span>
            <h3>Detalles de la Visita</h3>
            <div class="info-card" style="margin-bottom: 0;">
                <p class="detalle-linea"><strong>Fecha:</strong> <span id="visita-fecha"></span></p>
                <p class="detalle-linea"><strong>Tipo:</strong> <span id="visita-tipo"></span></p>
                <p class="detalle-linea"><strong>Motivo:</strong> <span id="visita-motivo"></span></p>
                <hr>
                <p class="detalle-linea"><strong>Exámenes Complementarios:</strong></p>
                <p id="visita-examenes" style="white-space: pre-wrap;"></p>
                <hr>
                <p class="detalle-linea"><strong>Diagnóstico:</strong></p>
                <p id="visita-diagnostico" style="white-space: pre-wrap;"></p>
                <hr>
                <p class="detalle-linea"><strong>Tratamiento:</strong></p>
                <p id="visita-tratamiento" style="white-space: pre-wrap;"></p>
                <hr>
                <p class="detalle-linea"><strong>Signos Vitales:</strong></p>
                <p><span class="info-label">Peso:</span> <span id="visita-peso"></span></p>
                <p><span class="info-label">Temperatura:</span> <span id="visita-temperatura"></span></p>
                <p><span class="info-label">Frec. Cardíaca:</span> <span id="visita-frec-cardiaca"></span></p>
                <p><span class="info-label">Frec. Respiratoria:</span> <span id="visita-frec-resp"></span></p>
                <hr>
                <p class="detalle-linea"><strong>Próxima Cita:</strong> <span id="visita-proxima-cita"></span></p>
                <hr>
                <p class="detalle-linea"><strong>Atendido por:</strong> <span id="visita-doctor"></span></p>
                <hr>
                <p class="detalle-linea"><strong>Archivos Adjuntos:</strong></p>
                <div id="visita-archivos-lista"></div>
            </div>
        </div>
    </div>
</body>
</html>